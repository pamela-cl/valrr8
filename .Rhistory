graph_error(data,"inc")
graph_error <- function(data, titles){
# Compute percentages
data$fraction = data$n / sum(data$n)
# Compute the cumulative percentages (top of each rectangle)
data$ymax = cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin = c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$flag, "\n value: ", data$n)
# Make the plot
a <- ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=flag)) +
geom_rect() +
coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
xlim(c(2, 4)) +
geom_label( x=3.5, aes(y=labelPosition, label=label), size=4) +
labs(
title = "Número de columnas con el formato incorrecto"
)+
theme_void()+
theme(
title = element_text(colour="black", size=12, face="bold"),
legend.position = "none"
)
print(a)
}
graph_error(data,"inc")
graph_error <- function(data, titles){
# Compute percentages
data$fraction = data$n / sum(data$n)
# Compute the cumulative percentages (top of each rectangle)
data$ymax = cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin = c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$flag, "\n value: ", data$n)
# Make the plot
a <- ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=flag)) +
geom_rect() +
coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
xlim(c(2, 4)) +
geom_label( x=3.5, aes(y=labelPosition, label=label), size=4) +
scale_fill_manual(
values = c("#ff0000","#009933")
) +
labs(
title = "Número de columnas con el formato incorrecto"
)+
theme_void()+
theme(
title = element_text(colour="black", size=12, face="bold"),
legend.position = none
)
print(a)
}
graph_error(data,"inc")
graph_error <- function(data, titles){
# Compute percentages
data$fraction = data$n / sum(data$n)
# Compute the cumulative percentages (top of each rectangle)
data$ymax = cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin = c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$flag, "\n value: ", data$n)
# Make the plot
a <- ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=flag)) +
geom_rect() +
coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
xlim(c(2, 4)) +
geom_label( x=3.5, aes(y=labelPosition, label=label), size=4) +
scale_fill_manual(
values = c("#ff0000","#009933")
) +
labs(
title = "Número de columnas con el formato incorrecto"
)+
theme_void()+
theme(
title = element_text(colour="black", size=12, face="bold"),
legend.position = "none"
)
print(a)
}
graph_error(data,"inc")
graph_error <- function(data, titles){
data <- data %>%
mutate(flag  = recode(FALSE = "Incorrectas", TRUE = "correctas"))
graph_error <- function(data, titles){
data <- data %>%
mutate(flag  = recode("FALSE" = "Incorrectas", "TRUE" = "correctas"))
# Compute percentages
data$fraction = data$n / sum(data$n)
# Compute the cumulative percentages (top of each rectangle)
data$ymax = cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin = c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$flag, "\n value: ", data$n)
# Make the plot
a <- ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=flag)) +
geom_rect() +
coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
xlim(c(2, 4)) +
geom_label( x=3.5, aes(y=labelPosition, label=label), size=4) +
scale_fill_manual(
values = c("#ff0000","#009933")
) +
labs(
title = "Número de columnas con el formato incorrecto"
)+
theme_void()+
theme(
title = element_text(colour="black", size=12, face="bold"),
legend.position = "none"
)
print(a)
}
graph_error(data,"inc")
graph_error <- function(data, titles){
data <- data %>%
mutate(flag  = case_when(
flag == FALSE ~ "Incorrectas",
TRUE ~ "Correctos"
))
# Compute percentages
data$fraction = data$n / sum(data$n)
# Compute the cumulative percentages (top of each rectangle)
data$ymax = cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin = c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$flag, "\n value: ", data$n)
# Make the plot
a <- ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=flag)) +
geom_rect() +
coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
xlim(c(2, 4)) +
geom_label( x=3.5, aes(y=labelPosition, label=label), size=4) +
scale_fill_manual(
values = c("#ff0000","#009933")
) +
labs(
title = "Número de columnas con el formato incorrecto"
)+
theme_void()+
theme(
title = element_text(colour="black", size=12, face="bold"),
legend.position = "none"
)
print(a)
}
graph_error(data,"inc")
graph_error <- function(data, titles){
data <- data %>%
mutate(flag  = case_when(
flag == FALSE ~ "Incorrectas",
TRUE ~ "Correctos"
))
# Compute percentages
data$fraction = data$n / sum(data$n)
# Compute the cumulative percentages (top of each rectangle)
data$ymax = cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin = c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$flag, "\n value: ", data$n)
# Make the plot
a <- ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=flag)) +
geom_rect() +
coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
xlim(c(2, 4)) +
geom_label( x=3.5, aes(y=labelPosition, label=label), size=4) +
scale_fill_manual(
palette = 4
) +
labs(
title = "Número de columnas con el formato incorrecto"
)+
theme_void()+
theme(
title = element_text(colour="black", size=12, face="bold"),
legend.position = "none"
)
print(a)
}
graph_error(data,"inc")
graph_error <- function(data, titles){
data <- data %>%
mutate(flag  = case_when(
flag == FALSE ~ "Incorrectas",
TRUE ~ "Correctos"
))
# Compute percentages
data$fraction = data$n / sum(data$n)
# Compute the cumulative percentages (top of each rectangle)
data$ymax = cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin = c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$flag, "\n value: ", data$n)
# Make the plot
a <- ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=flag)) +
geom_rect() +
coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
xlim(c(2, 4)) +
geom_label( x=3.5, aes(y=labelPosition, label=label), size=4) +
scale_fill_brewer(
palette = 4
) +
labs(
title = "Número de columnas con el formato incorrecto"
)+
theme_void()+
theme(
title = element_text(colour="black", size=12, face="bold"),
legend.position = "none"
)
print(a)
}
graph_error(data,"inc")
library(valrr8)
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
install.packages(c("shinyalert", "shinyanimate"))
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all(".")
devtools::load_all("."); devtools::document("."); run_app()
library(valrr8)
devtools::load_all("."); devtools::document("."); run_app()
install.packages("dashboardthemes")
devtools::load_all("."); devtools::document("."); run_app()
# llamo el catalogo con los tipos de columna y nombres
names_cat_dg <-
dplyr::mutate(
.data = readr::read_rds("inst/catalogos/cat_cnsf_dg_base.rds"),
tipo_r  = case_when(
tipo == "Caracter" ~ "character",
tipo %in% c("Numérico","Numerico") ~ "numeric",
tipo == "Fecha" ~ "date",
TRUE ~ "checar"
)
)
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
dashboardthemes::shinyDashboardThemes(
theme = "blue_gradient"
)
dashboardthemes::shinyDashboardThemes
dashboardthemes::theme_blue_gradient
devtools::load_all("."); devtools::document("."); run_app()
customTheme_pink_Gradient <- shinyDashboardThemeDIY(
### general
appFontFamily = "Arial"
,appFontColor = "#162936"
,primaryFontColor = "#0F0F0F"
,infoFontColor = "#0F0F0F"
,successFontColor = "#0F0F0F"
,warningFontColor = "#0F0F0F"
,dangerFontColor = "#0F0F0F"
,bodyBackColor = "#F5F5F5"
### header
,logoBackColor = "#162936"
,headerButtonBackColor = "#162936"
,headerButtonIconColor = "#DCDCDC"
,headerButtonBackColorHover = "#646464"
,headerButtonIconColorHover = "#3C3C3C"
,headerBackColor = "#162936"
,headerBoxShadowColor = ""
,headerBoxShadowSize = "0px 0px 0px"
### sidebar
,sidebarBackColor = cssGradientThreeColors(
direction = "down"
,colorStart = "#8a0030"
,colorMiddle = "#ff9b99"
,colorEnd = "#ffdeeb"
,colorStartPos = 0
,colorMiddlePos = 50
,colorEndPos = 100
)
,sidebarPadding = "0"
,sidebarMenuBackColor = "transparent"
,sidebarMenuPadding = "0"
,sidebarMenuBorderRadius = 0
,sidebarShadowRadius = ""
,sidebarShadowColor = "0px 0px 0px"
,sidebarUserTextColor = "#162936"
,sidebarSearchBackColor = "#F0F0F0"
,sidebarSearchIconColor = "#CF7651"
,sidebarSearchBorderColor = "#DCDCDC"
,sidebarTabTextColor = "#162936"
,sidebarTabTextSize = "14"
,sidebarTabBorderStyle = "none"
,sidebarTabBorderColor = "none"
,sidebarTabBorderWidth = "0"
,sidebarTabBackColorSelected = "#CF7651"
,sidebarTabTextColorSelected = "#162936"
,sidebarTabRadiusSelected = "0px"
,sidebarTabBackColorHover = "#CF7651"
,sidebarTabTextColorHover = "#162936"
,sidebarTabBorderStyleHover = "none solid none none"
,sidebarTabBorderColorHover = "#C8C8C8"
,sidebarTabBorderWidthHover = "4"
,sidebarTabRadiusHover = "0px"
### boxes
,boxBackColor = "#FFFFFF"
,boxBorderRadius = "5"
,boxShadowSize = "none"
,boxShadowColor = ""
,boxTitleSize = "18"
,boxDefaultColor = "#F8F8F8"
,boxPrimaryColor = "#1D4E89"
,boxInfoColor = "#00B2CA"
,boxSuccessColor = "#7DCFB6"
,boxWarningColor = "#FBD1A2"
,boxDangerColor = "#F79257"
,tabBoxTabColor = "#F8F8F8"
,tabBoxTabTextSize = "14"
,tabBoxTabTextColor = "#D5A188"
,tabBoxTabTextColorSelected = "#2D2D2D"
,tabBoxBackColor = "#FAF7F5"
,tabBoxHighlightColor = "#D5A188"
,tabBoxBorderRadius = "5"
### inputs
,buttonBackColor = "#D5A188"
,buttonTextColor = "#162936"
,buttonBorderColor = "#969696"
,buttonBorderRadius = "5"
,buttonBackColorHover = "#BEBEBE"
,buttonTextColorHover = "#162936"
,buttonBorderColorHover = "#969696"
,textboxBackColor = "#FFFFFF"
,textboxBorderColor = "#767676"
,textboxBorderRadius = "5"
,textboxBackColorSelect = "#F5F5F5"
,textboxBorderColorSelect = "#6C6C6C"
### tables
,tableBackColor = "#F8F8F8"
,tableBorderColor = "#EEEEEE"
,tableBorderTopSize = "1"
,tableBorderRowSize = "1"
)
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
dashboardthemes::cssGradientThreeColors
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all(".")
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
devtools::load_all("."); devtools::document("."); run_app()
input$files
tablas <- input$files %>%
tibble::as_tibble()
filtrar_tabla <- function(tabla, pattern){
to_return <- tabla %>%
dplyr::filter(stringr::str_detect(.$name,{{pattern}}))
return(to_return)
}
# tabla con los nombres de archivos y rutas solo para dge
tablas_dg <- input$files %>%
tibble::as_tibble() %>%
dplyr::filter(str_detect(.$name,"dg|DG|DGE|Dge|dge"))
tablas_dg_fun <- filtrar_tabla(tablas,"dg|DG|DGE|Dge|dge")
tablas_dg == tablas_dg_fun
tablas_dg <- input$files %>%
tibble::as_tibble() %>%
dplyr::filter(str_detect(.$name,"dg|DG|DGE|Dge|dge"))
# extraigo el nombre y año del ejercicio
tablas_dg <- tablas_dg %>%
dplyr::mutate(ramo = str_to_lower(str_sub(name,-7,-5))) %>%
# creo una nueva columna con la informacion de las tablas
dplyr::mutate(data = purrr::map(
.x = datapath,
.f = ~ readr::read_delim(
.x,
delim = "|"
) %>%
dplyr::select(c(1:(length(.)-1)))
)
)
filtrar_tabla <- function(tabla, pattern){
to_return <- tabla %>%
dplyr::filter(stringr::str_detect(.$name,{{pattern}})) %>%
dplyr::mutate(ramo = str_to_lower(str_sub(name,-7,-5))) %>%
# creo una nueva columna con la informacion de las tablas
dplyr::mutate(data = purrr::map(
.x = datapath,
.f = ~ readr::read_delim(
.x,
delim = "|"
) %>%
dplyr::select(c(1:(length(.)-1)))
)
)
return(to_return)
}
tablas_dg_fun <- filtrar_tabla(tablas,"dg|DG|DGE|Dge|dge")
tablas_dg == tablas_dg_fun
View(tablas_dg)
View(tablas_dg_fun)
View(tablas_dg_fun[[6]][[1]])
filtrar_tabla <- function(tabla, pattern){
to_return <- tabla %>%
dplyr::filter(stringr::str_detect(.$name,{{pattern}})) %>%
dplyr::mutate(ramo = str_to_lower(str_sub(name,-7,-5))) %>%
# creo una nueva columna con la informacion de las tablas
dplyr::mutate(data = purrr::map(
.x = datapath,
.f = ~ readr::read_delim(
.x,
delim = "|"
) %>%
dplyr::select(c(1:(length(.)-1)))
)
) %>%
dplyr::mutate(
data = purrr::map2(
.id = NULL,
.x = data,
.y = ramo,
.f = ~ setNames(.x,
names_cat_dg %>%
filter(riesgo == .y) %>%
pull(clean_campo)
)
)
)
print(paste("--archivos leídos",pattern))
return(to_return)
}
tablas_dg_fun <- filtrar_tabla(tablas,"dg|DG|DGE|Dge|dge")
tablas_dg <- input$files %>%
tibble::as_tibble() %>%
dplyr::filter(str_detect(.$name,"dg|DG|DGE|Dge|dge"))
# extraigo el nombre y año del ejercicio
tablas_dg <- tablas_dg %>%
dplyr::mutate(ramo = str_to_lower(str_sub(name,-7,-5))) %>%
# creo una nueva columna con la informacion de las tablas
dplyr::mutate(data = purrr::map(
.x = datapath,
.f = ~ readr::read_delim(
.x,
delim = "|"
) %>%
dplyr::select(c(1:(length(.)-1)))
)
)
print("--archivos leídos")
# Ponemos los nombres adecuados a las tablas
tablas_dg <- tablas_dg %>%
dplyr::mutate(
data = purrr::map2(
.id = NULL,
.x = data,
.y = ramo,
.f = ~ setNames(.x,
names_cat_dg %>%
filter(riesgo == .y) %>%
pull(clean_campo)
)
)
)
View(tablas_dg)
View(tablas_dg_fun)
View(tablas_dg[[6]][[1]])
View(tablas_dg_fun[[6]][[1]])
tablas_dge_fun <- filtrar_tabla(tablas,"dg|DG|DGE|Dge|dge")
tablas_emi_fun <- filtrar_tabla(tablas,"emi|EMI|Emi|emisión|emision")
tablas_sin_fun <- filtrar_tabla(tablas,"sin|SIN|Sin|siniestros|Siniestros")
view(tablas_sin_fun)
View(tablas_sin_fun)
View(tablas_sin_fun[[6]][[1]])
View(tablas_sin_fun[[6]][[2]])
View(tablas_sin_fun[[6]][[3]])
