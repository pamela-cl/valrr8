select(c(1:(length(.x)-1))) %>%
setNames(names_cat_dg %>%
filter(riesgo == ramo ) %>%
pull(clean_campo))
)
)
View(tablas_dg)
View(tablas_dg[[7]][[1]])
tablas_dg
iris %>% select(c(1:(length(.)-1)))
# extraigo el nombre y año del ejercicio
tablas_dg <- tablas_dg %>%
mutate(ramo = str_to_lower(str_sub(name,-7,-5)),
year = str_to_lower(str_sub(name,-10,-9))) %>%
# creo una nueva columna con la informacion de las tablas
mutate(data = purrr::map(
.x = datapath,
.f = ~ read_delim(
.x,
delim = "|"
) %>%
select(c(1:(length(.)-1))) %>%
setNames(names_cat_dg %>%
filter(riesgo == ramo ) %>%
pull(clean_campo))
)
)
View(tablas_dg)
View(tablas_dg[[7]][[1]])
names_cat_dg %>%
filter(riesgo == "inc") %>%
pull(clean_campo)
# extraigo el nombre y año del ejercicio
tablas_dg <- tablas_dg %>%
mutate(ramo = str_to_lower(str_sub(name,-7,-5)),
year = str_to_lower(str_sub(name,-10,-9))) %>%
# creo una nueva columna con la informacion de las tablas
mutate(data = purrr::map(
.x = datapath,
.f = ~ read_delim(
.x,
delim = "|"
) %>%
select(c(1:(length(.)-1)))
)
) %>%
unframe(data)
# extraigo el nombre y año del ejercicio
tablas_dg <- tablas_dg %>%
mutate(ramo = str_to_lower(str_sub(name,-7,-5)),
year = str_to_lower(str_sub(name,-10,-9))) %>%
# creo una nueva columna con la informacion de las tablas
mutate(data = purrr::map(
.x = datapath,
.f = ~ read_delim(
.x,
delim = "|"
) %>%
select(c(1:(length(.)-1)))
)
) %>%
deframe(data)
library(tibble)
# extraigo el nombre y año del ejercicio
tablas_dg <- tablas_dg %>%
mutate(ramo = str_to_lower(str_sub(name,-7,-5)),
year = str_to_lower(str_sub(name,-10,-9))) %>%
# creo una nueva columna con la informacion de las tablas
mutate(data = purrr::map(
.x = datapath,
.f = ~ read_delim(
.x,
delim = "|"
) %>%
select(c(1:(length(.)-1)))
)
) %>%
deframe(data)
# extraigo el nombre y año del ejercicio
tablas_dg <- tablas_dg %>%
mutate(ramo = str_to_lower(str_sub(name,-7,-5)),
year = str_to_lower(str_sub(name,-10,-9))) %>%
# creo una nueva columna con la informacion de las tablas
mutate(data = purrr::map(
.x = datapath,
.f = ~ read_delim(
.x,
delim = "|"
) %>%
select(c(1:(length(.)-1)))
)
) %>%
unlist(data)
tablas_dg
# tabla con los nombres de archivos y rutas solo para dge
tablas_dg <- input$files %>%
as_tibble() %>%
filter(str_detect(.$name,"dg|DG|DGE|Dge|dge"))
# extraigo el nombre y año del ejercicio
tablas_dg <- tablas_dg %>%
mutate(ramo = str_to_lower(str_sub(name,-7,-5)),
year = str_to_lower(str_sub(name,-10,-9))) %>%
# creo una nueva columna con la informacion de las tablas
mutate(data = purrr::map(
.x = datapath,
.f = ~ read_delim(
.x,
delim = "|"
) %>%
select(c(1:(length(.)-1))) %>%
unlist()
)
)
View(tablas_dg)
# extraigo el nombre y año del ejercicio
tablas_dg <- tablas_dg %>%
mutate(ramo = str_to_lower(str_sub(name,-7,-5)),
year = str_to_lower(str_sub(name,-10,-9))) %>%
# creo una nueva columna con la informacion de las tablas
mutate(data = purrr::map(
.x = datapath,
.f = ~ read_delim(
.x,
delim = "|"
) %>%
select(c(1:(length(.)-1)))
)
)
View(tablas_dg)
View(tablas_dg[[7]][[1]])
tablas_dg
tablas_dg$data
names_cat_dg
tablas_dg %>%
mutate(
data = purrr::map2(
.x = data,
.y = ramo,
.f = ~ setNames(.x,
names_cat_dg %>%
filter(riesgo == .y) %>%
pull(clean_campo)
)
)
)
tablas <- tablas_dg %>%
mutate(
data = purrr::map2(
.x = data,
.y = ramo,
.f = ~ setNames(.x,
names_cat_dg %>%
filter(riesgo == .y) %>%
pull(clean_campo)
)
)
)
View(tablas)
View(tablas[[7]][[1]])
names_cat_dg %>%
filter(riesgo == "inc") %>%
pull(clean_campo)
View(tablas[[7]][[3]])
View(tablas[[7]][[2]])
gsub("\\_","",c("numero_de_poliza_2"."numero_de_poliza_2","numero_de_poliza_3"))
gsub("\\_","",c("numero_de_poliza_2","numero_de_poliza_2","numero_de_poliza_3"))
gsub("\\_","",c("numero_de_poliza","numero_de_poliza_2","numero_de_poliza_3"))
gsub("\\_(.*)[0-9]+?","",c("numero_de_poliza","numero_de_poliza_2","numero_de_poliza_3"))
gsub("\\_(.*)[0-9]","",c("numero_de_poliza","numero_de_poliza_2","numero_de_poliza_3"))
gsub("\\_&(.*)[0-9]","",c("numero_de_poliza","numero_de_poliza_2","numero_de_poliza_3"))
gsub("\\_[0-9]","",c("numero_de_poliza","numero_de_poliza_2","numero_de_poliza_3"))
tablas_dg$data[1]
tablas_dg <- tablas_dg %>%
mutate(
data = purrr::map2(
.x = data,
.y = ramo,
.f = ~ setNames(.x,
names_cat_dg %>%
filter(riesgo == .y) %>%
pull(clean_campo)
)
)
)
tablas_dg$data[1]
tablas <- map(
.x = tablas_dg$data[],
.f = colnames(.x,gsub("\\_[0-9]","",colnames(.x)))
)
tablas <- purrr::map(
.x = tablas_dg$data[],
.f = colnames(.x,gsub("\\_[0-9]","",colnames(.x)))
)
tablas <- purrr::map(
.x = tablas_dg$data[],
.f = ~ colnames(.x,gsub("\\_[0-9]","",colnames(.x)))
)
tablas <- purrr::map(
.x = tablas_dg$data[[]],
.f = ~ colnames(.x,gsub("\\_[0-9]","",colnames(.x)))
)
tablas <- tablas_dg %>%
mutate(data =
purrr::map(
.x = data ,
.f = ~ colnames(.x,gsub("\\_[0-9]","",colnames(.x)))
)
)
library(purrr)
# tabla con los nombres de archivos y rutas solo para dge
tablas_dg <- input$files %>%
as_tibble() %>%
filter(str_detect(.$name,"dg|DG|DGE|Dge|dge"))
# extraigo el nombre y año del ejercicio
tablas_dg <- tablas_dg %>%
mutate(ramo = str_to_lower(str_sub(name,-7,-5)),
year = str_to_lower(str_sub(name,-10,-9))) %>%
# creo una nueva columna con la informacion de las tablas
mutate(data = purrr::map(
.x = datapath,
.f = ~ read_delim(
.x,
delim = "|"
) %>%
select(c(1:(length(.)-1)))
)
)
tablas_dg <- tablas_dg %>%
mutate(
data = purrr::map2(
.id = NULL,
.x = data,
.y = ramo,
.f = ~ setNames(.x,
names_cat_dg %>%
filter(riesgo == .y) %>%
pull(clean_campo)
)
)
)
View(tablas_dg)
View(tablas_dg[[7]][[2]])
# tabla con los nombres de archivos y rutas solo para dge
tablas_dg <- input$files %>%
as_tibble() %>%
filter(str_detect(.$name,"dg|DG|DGE|Dge|dge"))
# extraigo el nombre y año del ejercicio
tablas_dg <- tablas_dg %>%
mutate(ramo = str_to_lower(str_sub(name,-7,-5)),
year = str_to_lower(str_sub(name,-10,-9))) %>%
# creo una nueva columna con la informacion de las tablas
mutate(data = purrr::map(
.x = datapath,
.f = ~ read_delim(
.x,
delim = "|"
) %>%
select(c(1:(length(.)-1)))
)
)
tablas <- tablas_dg %>%
mutate(
data = purrr::map2(
.id = NULL,
.x = data,
.y = ramo,
.f = ~ setNames(.x,
names_cat_dg %>%
filter(riesgo == .y) %>%
pull(clean_campo)
)
)
) %>%
mutate(
data = purrr::map2(
.id = NULL,
.x = data,
.y = ramo,
.f = ~ colnames(.x,
gsub("\\_[0-9]","",colnames(.x))
)
)
)
tablas <- tablas_dg %>%
mutate(
data = purrr::map2(
.id = NULL,
.x = data,
.y = ramo,
.f = ~ setNames(.x,
names_cat_dg %>%
filter(riesgo == .y) %>%
pull(clean_campo)
)
)
)
View(tablas)
View(tablas[[7]][[1]])
View(tablas[[7]][[2]])
tablas_dg$data[1]
tablas$data[1]
tablas$data[2]
colnames(tablas$data[2])
colnames(tablas$data[[1]])
colnames(tablas$data[[2]])
tablas <- tablas_dg %>%
mutate(
data = purrr::map2(
.id = NULL,
.x = data,
.y = ramo,
.f = ~ setNames(.x,
names_cat_dg %>%
filter(riesgo == .y) %>%
pull(clean_campo)
)
)
)
tablas %>%
mutate(
data = purrr::map2(
.id = NULL,
.x = data,
.y = ramo,
.f = ~ colnames(.x,
gsub("\\_[0-9]","",colnames(.x[]))
)
)
)
tablas %>%
mutate(
data = purrr::map2(
.id = NULL,
.x = data[[]],
.y = ramo,
.f = ~ colnames(.x,
gsub("\\_[0-9]","",colnames(.x))
)
)
)
tablas %>%
mutate(
data = purrr::map2(
.id = NULL,
.x = data[],
.y = ramo,
.f = ~ colnames(.x,
gsub("\\_[0-9]","",colnames(.x))
)
)
)
colnames(tablas$data[[2]])
colnames(tablas$data[[2]]) %>% gsub("\_[0-9]","")
colnames(tablas$data[[2]]) %>% gsub("\\_[0-9]","")
gsub("\\_[0-9]","",colnames(tablas$data[[2]]))
colnames(tablas$data[[2]]) %>% gsub("\_[0-9]","",.)
colnames(tablas$data[[2]]) %>% gsub("\\_[0-9]","",.)
gsub("\\_[0-9]","",colnames(tablas$data[[2]]))
View(tablas)
View(tablas[[7]][[2]])
colnames(tablas$data[[2]]) <- gsub("\\_[0-9]","",
colnames(tablas$data[[2]]))
colnames(tablas$data[[3]]) <- gsub("\\_[0-9]","",
colnames(tablas$data[[3]]))
View(tablas)
View(tablas[[7]][[2]])
View(tablas[[7]][[3]])
input$files
tools::file_ext(file$datapath)
file <- input$files
ext <- tools::file_ext(file$datapath)
req(file)
validate(need(ext == "txt", "Please upload a txt file"))
load_all()
run_app()
run_app()
run_app()
run_app()
load_all()
run_app()
input$files
file <- input$files
ext <- tools::file_ext(file$datapath)
req(file)
validate
validate(need(ext == "txt", "Please upload a txt file"))
ext
file <- input$files
ext <- tools::file_ext(file$datapath)
req(file)
ext <- tools::file_ext(file$datapath)
ext
if (interactive()) {
ui <- fluidPage(
sidebarLayout(
sidebarPanel(
fileInput("file1", "Choose CSV File", accept = ".csv"),
checkboxInput("header", "Header", TRUE)
),
mainPanel(
tableOutput("contents")
)
)
)
server <- function(input, output) {
output$contents <- renderTable({
file <- input$file1
ext <- tools::file_ext(file$datapath)
req(file)
validate(need(ext == "csv", "Please upload a csv file"))
read.csv(file$datapath, header = input$header)
})
}
shinyApp(ui, server)
}
if (interactive()) {
ui <- fluidPage(
sidebarLayout(
sidebarPanel(
fileInput("file1", "Choose CSV File", accept = ".csv"),
checkboxInput("header", "Header", TRUE)
),
mainPanel(
tableOutput("contents")
)
)
)
server <- function(input, output) {
output$contents <- renderTable({
file <- input$file1
ext <- tools::file_ext(file$datapath)
req(file)
validate(need(ext == "csv", "Please upload a csv file"))
read.csv(file$datapath, header = input$header)
})
}
shinyApp(ui, server)
}
run_app()
load_all()
run_app()
file <- input$files
ext <- tools::file_ext(file$datapath)
run_app()
file <- input$files
ext <- tools::file_ext(file$datapath)
req(file)
length(ext == "txt")
length(ext)
str_detect(ext)
str_detect(ext,"txt")
sum(str_detect(ext,"txt"))
sum(str_detect(ext,"txt")) != length(ext)
sum(str_detect(ext,"txt")) == length(ext)
load_all()
run_app()
load_all()
run_app()
load_all()
run_app()
load_all()
run_app()
load_all()
load_all()
load_all()
run_app()
load_all()
run_app()
load_all()
load_all()
run_app()
run_app()
load_all()
run_app()
load_all()
run_app()
load_all()
run_app()
load_all()
run_app()
load_all()
run_app()
View(tablas_dg)
View(tablas_dg[[7]][[1]])
View(tablas_dg[[7]][[2]])
View(tablas_dg)
View(tablas_dg[[7]][[1]])
View(tablas_dg[[7]][[2]])
View(tablas_dg[[7]][[3]])
# quitamos el sufijo creado por el map
colnames(tablas_dg$data[[1]]) <- gsub("\\_[0-9]","",
colnames(tablas_dg$data[[1]]))
colnames(tablas_dg$data[[2]]) <- gsub("\\_[0-9]","",
colnames(tablas_dg$data[[2]]))
colnames(tablas_dg$data[[3]]) <- gsub("\\_[0-9]","",
colnames(tablas_dg$data[[3]]))
View(tablas_dg)
View(tablas_dg[[7]][[1]])
View(tablas_dg)
prueba <- tablas_dg %>% pull(data())
prueba <- tablas_dg %>% pull(data)
View(prueba)
View(prueba[[1]])
setNames(prueba, tablas_dg$ramo)
View(tablas_dg[[7]][[1]])
View(tablas_dg[[7]][[3]])
tabla_gen_dge <- tablas_dg %>% pull(data)
setNames(tabla_gen_dge, tablas_dg$ramo)
rm(tablas_dg)
rm(prueba)
load_all()
run_app()
